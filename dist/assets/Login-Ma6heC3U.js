import{u as F,r as a,j as t,L as R,a as x}from"./index-mf7HjnXv.js";const A=()=>{const l=F(),[i,j]=a.useState(""),[d,y]=a.useState(""),[u,N]=a.useState(""),[b,S]=a.useState(""),[m,v]=a.useState(""),[h,P]=a.useState(""),[c,L]=a.useState("password"),[w,I]=a.useState(!1),[n,r]=a.useState(!1),[g,p]=a.useState(0);a.useEffect(()=>{o()},[]),a.useEffect(()=>{if(g>0){const e=setInterval(()=>p(s=>s-1),1e3);return()=>clearInterval(e)}},[g]);const o=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let s="";for(let f=0;f<6;f++)s+=e[Math.floor(Math.random()*e.length)];P(s),v(s)},O=e=>{const s=Math.floor(e/60),f=e%60;return`${s}:${f.toString().padStart(2,"0")}`},C=e=>{L(e),I(!1),S(""),p(0),y(""),j(""),N(""),o()},T=async()=>{if(!i.trim()){alert("Please enter your phone number");return}if(m!==h){alert("Invalid Captcha"),o();return}r(!0);try{const e=await x.post("/api/auth/send-otp",{phone:i.trim()});e.data.success&&(I(!0),p(300),alert(e.data.message))}catch(e){alert(e.response?.data?.message||"Failed to send OTP")}finally{r(!1)}},E=async()=>{r(!0);try{const e=await x.post("/api/auth/resend-otp",{phone:i.trim()});e.data.success&&(p(300),alert(e.data.message))}catch(e){alert(e.response?.data?.message||"Failed to resend OTP")}finally{r(!1)}},k=async()=>{if(!b.trim()){alert("Please enter the OTP");return}r(!0);try{const e=await x.post("/api/auth/verify-otp-login",{phone:i.trim(),otp:b.trim()});e.data.success&&(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","user"),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.needsVerification?l("/verification"):l("/dashboard"),window.location.reload())}catch(e){alert(e.response?.data?.message||"OTP verification failed")}finally{r(!1)}},M=async()=>{if(!d.trim()){alert("Please enter your email");return}if(!u.trim()){alert("Please enter your password");return}if(m!==h){alert("Invalid Captcha"),o();return}if(d==="aravind@gmail.com"&&u==="aravind@gmail.com"){localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","admin"),alert("Admin login successful!"),l("/admin"),window.location.reload();return}r(!0);try{const e=await x.post("/api/auth/login",{email:d.trim(),password:u.trim()});localStorage.setItem("isLoggedIn","true");const s=Array.isArray(e.data.user.roles)?e.data.user.roles[0]:e.data.user.roles;localStorage.setItem("role",s),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.user.needsVerification||!e.data.user.isFullyVerified?l("/verification"):l("/dashboard"),window.location.reload()}catch(e){alert(e.response?.data?.message||"Login failed")}finally{r(!1)}};return t.jsx("div",{className:"d-flex align-items-center justify-content-center min-vh-100",style:{background:`linear-gradient(rgba(0,128,0,0.3), rgba(255,255,255,0.2)), 
               url("https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=1500&q=80") center/cover no-repeat`,minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("div",{style:{width:"100%",zIndex:2},children:t.jsx("div",{className:"d-flex justify-content-center",children:t.jsxs("div",{className:"card shadow-lg rounded-4 p-4",style:{maxWidth:"400px",width:"90%",backgroundColor:"rgba(255,255,255,0.95)",border:"2px solid #1abc9c"},children:[t.jsx("h3",{className:"text-center mb-3 text-success",children:c==="password"?"Login with Email":"Login with OTP"}),t.jsxs("div",{className:"btn-group w-100 mb-3",children:[t.jsx("button",{className:`btn ${c==="password"?"btn-success":"btn-outline-success"}`,onClick:()=>C("password"),children:"Email & Password"}),t.jsx("button",{className:`btn ${c==="otp"?"btn-success":"btn-outline-success"}`,onClick:()=>C("otp"),children:"Phone & OTP"})]}),c==="password"&&t.jsxs("div",{className:"d-flex flex-column gap-3",children:[t.jsx("input",{type:"email",placeholder:"Email",className:"form-control",value:d,onChange:e=>y(e.target.value)}),t.jsx("input",{type:"password",placeholder:"Password",className:"form-control",value:u,onChange:e=>N(e.target.value)}),t.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[t.jsx("div",{className:"btn btn-outline-success",children:h}),t.jsx("button",{className:"btn btn-outline-success",onClick:o,children:"↻"}),t.jsx("input",{type:"text",placeholder:"Enter Captcha",className:"form-control",value:m,onChange:e=>v(e.target.value)})]}),t.jsx("button",{className:"btn btn-success btn-lg",onClick:M,disabled:n,children:n?"Logging in...":"Login"})]}),c==="otp"&&t.jsxs("div",{className:"d-flex flex-column gap-3",children:[t.jsx("input",{type:"text",placeholder:"Phone Number",className:"form-control",value:i,onChange:e=>j(e.target.value),disabled:w}),w?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",placeholder:"Enter OTP",className:"form-control",value:b,onChange:e=>S(e.target.value),maxLength:6}),g>0?t.jsxs("span",{className:"text-muted small",children:["Resend OTP in ",O(g)]}):t.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:E,disabled:n,children:n?"Sending...":"Resend OTP"}),t.jsx("button",{className:"btn btn-success btn-lg",onClick:k,disabled:n,children:n?"Verifying...":"Verify & Login"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[t.jsx("div",{className:"btn btn-outline-success",children:h}),t.jsx("button",{className:"btn btn-outline-success",onClick:o,children:"↻"})]}),t.jsx("input",{type:"text",placeholder:"Enter Captcha",className:"form-control",value:m,onChange:e=>v(e.target.value)}),t.jsx("button",{className:"btn btn-success btn-lg",onClick:T,disabled:n,children:n?"Sending OTP...":"Send OTP"})]})]}),t.jsxs("p",{className:"text-center mt-3",children:["Don't have an account? ",t.jsx(R,{to:"/register",className:"text-success",children:"Register"})]})]})})})})};export{A as default};
