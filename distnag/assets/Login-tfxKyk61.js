import{u as M,r as s,j as t,L as R,a as x}from"./index-2Wk2D7Ja.js";const V=()=>{const l=M(),[i,y]=s.useState(""),[c,N]=s.useState(""),[d,S]=s.useState(""),[b,w]=s.useState(""),[u,j]=s.useState(""),[m,P]=s.useState(""),[p,O]=s.useState("password"),[C,I]=s.useState(!1),[n,r]=s.useState(!1),[h,g]=s.useState(0);s.useEffect(()=>{o()},[]),s.useEffect(()=>{if(h>0){const e=setInterval(()=>{g(a=>a-1)},1e3);return()=>clearInterval(e)}},[h]);const o=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let a="";for(let f=0;f<6;f++)a+=e[Math.floor(Math.random()*e.length)];P(a),j(a)},L=async()=>{if(!i.trim()){alert("Please enter your phone number");return}if(u!==m){alert("Invalid Captcha"),o();return}r(!0);try{const e=await x.post("/api/auth/send-otp",{phone:i.trim()});e.data.success&&(I(!0),g(300),alert(e.data.message))}catch(e){alert(e.response?.data?.message||"Failed to send OTP")}finally{r(!1)}},T=async()=>{r(!0);try{const e=await x.post("/api/auth/resend-otp",{phone:i.trim()});e.data.success&&(g(300),alert(e.data.message))}catch(e){alert(e.response?.data?.message||"Failed to resend OTP")}finally{r(!1)}},k=async()=>{if(!b.trim()){alert("Please enter the OTP");return}r(!0);try{const e=await x.post("/api/auth/verify-otp-login",{phone:i.trim(),otp:b.trim()});e.data.success&&(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","user"),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.needsVerification?l("/verification"):l("/dashboard"),window.location.reload())}catch(e){alert(e.response?.data?.message||"OTP verification failed")}finally{r(!1)}},E=async()=>{if(!c.trim()){alert("Please enter your email");return}if(!d.trim()){alert("Please enter your password");return}if(u!==m){alert("Invalid Captcha"),o();return}if(c==="aravind@gmail.com"&&d==="aravind@gmail.com"){localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","admin"),alert("Admin login successful!"),l("/admin"),window.location.reload();return}r(!0);try{const e=await x.post("/api/auth/login",{email:c.trim(),password:d.trim()});localStorage.setItem("isLoggedIn","true");const a=Array.isArray(e.data.user.roles)?e.data.user.roles[0]:e.data.user.roles;localStorage.setItem("role",a),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.user.needsVerification||!e.data.user.isFullyVerified?l("/verification"):l("/dashboard"),window.location.reload()}catch(e){alert(e.response?.data?.message||"Login failed")}finally{r(!1)}},A=e=>{const a=Math.floor(e/60),f=e%60;return`${a}:${f.toString().padStart(2,"0")}`},v=e=>{O(e),I(!1),w(""),g(0),N(""),y(""),S(""),o()};return t.jsx("div",{className:"container mt-5 mb-5",children:t.jsx("section",{className:"signup_section",children:t.jsxs("div",{className:"signup_form",children:[t.jsx("div",{className:"d-flex justify-content-center align-items-center ",children:t.jsxs("div",{className:" p-4 text-center",style:{maxWidth:"400px",width:"100%",borderRadius:"15px"},children:[t.jsx("div",{className:"section_title",children:t.jsxs("h2",{children:[" ",t.jsx("span",{children:"Create"})," an account"]})}),t.jsxs("div",{className:"btn-group ",role:"group",children:[t.jsxs("button",{type:"button",className:`btn ${p==="password"?"btn-success":"btn-outline-success"}`,onClick:()=>v("password"),children:[t.jsx("i",{className:"bi bi-envelope me-2"})," Email & Password"]}),t.jsxs("button",{type:"button",className:`btn ${p==="otp"?"btn-success":"btn-outline-success"}`,onClick:()=>v("otp"),children:[t.jsx("i",{className:"bi bi-phone me-2"})," Phone & OTP"]})]})]})}),p==="password"&&t.jsxs("div",{className:"p-3",children:[t.jsx("div",{className:"form-group",children:t.jsx("input",{type:"email",className:"form-control",placeholder:"Email Address",value:c,onChange:e=>N(e.target.value)})}),t.jsx("div",{className:"form-group",children:t.jsx("input",{type:"password",className:"form-control",placeholder:"Password",value:d,onChange:e=>S(e.target.value)})}),t.jsxs("div",{className:"form-group d-flex justify-content-end gap-2",children:[t.jsx("div",{className:"btn btn-outline-success",children:m}),t.jsx("button",{type:"button",onClick:o,className:"btn btn-outline-success",children:"↻"}),t.jsx("input",{type:"text",placeholder:"Enter Captcha",className:"form-control",value:u,onChange:e=>j(e.target.value)})]}),t.jsx("div",{className:"form-group d-flex justify-content-center",children:t.jsx("button",{onClick:E,disabled:n,className:"btn btn-outline-success",children:n?"Logging in...":"Login with Email"})})]}),p==="otp"&&t.jsxs("div",{className:"p-3",children:[t.jsx("div",{className:"form-group",children:t.jsx("input",{type:"text",placeholder:"Phone Number",className:"form-control",value:i,onChange:e=>y(e.target.value),disabled:C})}),C?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",placeholder:"Enter 6-digit OTP",value:b,onChange:e=>w(e.target.value),maxLength:6}),t.jsx("div",{className:"otp-timer",children:h>0?t.jsxs("span",{children:["Resend OTP in ",A(h)]}):t.jsx("button",{onClick:T,disabled:n,type:"button",className:"resend-btn",children:n?"Sending...":"Resend OTP"})}),t.jsx("button",{onClick:k,disabled:n,children:n?"Verifying...":"Verify & Login"}),t.jsx("button",{onClick:()=>v("otp"),type:"button",className:"back-btn",children:"Back"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:" gap-3",children:[t.jsxs("div",{className:"form-group gap-2",children:[t.jsx("div",{className:"btn btn-outline-success",children:m}),t.jsx("button",{type:"button",onClick:o,className:"btn btn-outline-success",children:"↻"})]}),t.jsx("div",{className:"form-group",children:t.jsx("input",{type:"text",placeholder:"Enter Captcha",className:"form-control",value:u,onChange:e=>j(e.target.value)})})]}),t.jsx("div",{className:"form-group d-flex justify-content-center",children:t.jsx("button",{onClick:L,disabled:n,className:"btn btn-outline-success",children:n?"Sending OTP...":"Send OTP"})})]})]}),t.jsxs("h6",{style:{textAlign:"center"},children:["You Don't have Account ",t.jsx(R,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]})})})};export{V as default};
